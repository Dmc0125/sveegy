<script lang="ts">
import IconWrapper from './IconWrapper.svelte'

import icons from '$lib/assets/icons.json'
import capitalize from '$lib/utils/capitalize';
import { fade, fly } from 'svelte/transition'
import { createSvgHtml, createSvgJsx } from '$lib/utils/createSvgHtml'
import createDownloadUrl from '$lib/utils/createDownloadUrl'
import { usingClasses, svgClass, svgColor, svgSize } from '$lib/store'
import Buttons from './Buttons.svelte';
import IconSettings from './IconSettings.svelte';
import { browser } from '$app/env';

let iconName: string
export { iconName as icon }

const closePopup = () => {
  iconName = ''
}

const closeOnKeydown = (e: KeyboardEvent) => {
  if (e.key === 'Escape') {
    closePopup()
  }
}

$: icon = icons.find(({ id }) => (id === iconName.toLowerCase()))

$: svgHtml = icon && createSvgHtml(icon.paths, {
  classes: $usingClasses,
  className: $svgClass,
  size: $svgSize,
  color: $svgColor,
})
$: svgJsx = icon && createSvgJsx(icon.paths, {
  classes: $usingClasses,
  className: $svgClass,
  size: $svgSize,
  color: $svgColor,
})
$: downloadUrl = browser && createDownloadUrl(svgHtml)

let mode: 'jsx' | 'html'
</script>

<svelte:window on:keydown="{closeOnKeydown}" />

{#if iconName.length}
  <div
    class="w-screen h-screen fixed dimmed-bg z-10"
    on:click="{closePopup}"
    transition:fade
  >
    <section
      class="
        w-full max-h-[90%] h-fit px-6 py-4 absolute bottom-0 default-bg font-default-clr rounded-t-lg overflow-y-auto
        grid grid-cols-1 md:grid-rows-[repeat(3,auto)] gap-4 md:grid-cols-2 md:rounded-lg md:max-w-[850px] transform left-1/2 -translate-x-1/2
        md:-translate-y-1/2 md:top-1/2
      "
      transition:fly={{ y: 100 }}
      on:click|stopPropagation
    >
      <header class="flex items-center justify-between col-span-full">
        <h1 class="text-3xl font-semibold">{icon ? capitalize(icon.id) : capitalize(`${iconName} icon`)}</h1>

        <button
          class="w-10 h-10 rounded-md ring-effect default-hover-bg"
          on:click="{closePopup}"
        >
          <IconWrapper class="w-full h-full md:hidden" icon="chevron-down" />
          <IconWrapper class="w-full h-full hidden md:block" icon="close" />
        </button>
      </header>

      {#if icon}
        <div class="
          w-full h-40 mx-auto bg-gradient-to-tr from-sky-300 to-purple-400 flex items-center justify-center rounded-lg
          md:[grid-column:1/2]
        ">
          <div class="h-full w-full bg-opacity-[60%_!important] default-bg rounded-lg">
            <IconWrapper icon="{icon.id}" />
          </div>
        </div>

        <div class="w-full h-fit secondary-bg rounded-md relative col-span-full">
          <Buttons copyIcon={iconName} bind:lang={mode} icon="trade" class="w-52 h-8" isSwitch="{true}">
            <IconWrapper slot="icon" icon="copy" class="w-6 h-6 mx-auto" />
          </Buttons>
          <div class="w-full h-fit pt-8 overflow-x-auto">
            <pre class="w-fit h-fit px-4 pb-4">
              {mode === 'html' ? svgHtml : svgJsx}
            </pre>
          </div>
        </div>

        <div class="w-full h-fit md:[grid-column:2/3] md:[grid-row:2/3]">
          <IconSettings>
            <a
              class="justify-self-start btn cta-bg px-4 flex items-center text-slate-300"
              href="{downloadUrl}"
              download="{`${iconName}-icon`}"
            >
              Download
              <span class="w-7 h-7 ml-2">
                <IconWrapper icon="download" />
              </span>
            </a>
          </IconSettings>
        </div>
      {:else}
        <h2 class="text-center font-semibold text-xl my-4 col-span-full">Icon {iconName} was not find...</h2>
        <div class="w-1/2 md:w-[400px] h-full mx-auto col-span-full">
          <svg width="100%" height="72%" viewBox="0 0 624 451" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0)">
              <path d="M547.396 219.679h-5.554V439.29h5.554V219.679z" fill="#3F3D56"/>
              <path d="M598.658 247.666c.354 76.792-53.623 139.296-53.623 139.296s-54.551-62.003-54.904-138.796c-.354-76.792 53.623-139.296 53.623-139.296s54.551 62.003 54.904 138.796zM436.331 323.009h-2.856v112.952h2.856V323.009z" fill="#3F3D56"/>
              <path d="M462.698 337.404c.182 39.496-27.58 71.643-27.58 71.643s-28.056-31.89-28.238-71.386c-.182-39.496 27.58-71.643 27.58-71.643s28.056 31.889 28.238 71.386zM492.642 451c42.748 0 77.402-5.317 77.402-11.876 0-6.558-34.654-11.875-77.402-11.875s-77.402 5.317-77.402 11.875c0 6.559 34.654 11.876 77.402 11.876z" fill="#3F3D56"/>
              <path d="M499.027 162.346c-6.557-11.09-19.531-11.607-19.531-11.607s-12.642-1.619-20.752 15.273c-7.559 15.744-17.992 30.945-1.68 34.631l2.947-9.179 1.824 9.862c2.323.168 4.653.207 6.98.12 17.469-.565 34.105.165 33.569-6.11-.712-8.341 2.953-22.318-3.357-32.99z" fill="#2F2E41"/>
              <path d="M475.41 183.233s8.475 11.875 3.39 21.489c-5.085 9.613 11.865 19.793 11.865 19.793l12.429-27.145s-14.689-9.613-10.735-18.661l-16.949 4.524z" fill="#FBBEBE"/>
              <path d="M481.061 188.322c8.112 0 14.689-6.583 14.689-14.703s-6.577-14.703-14.689-14.703c-8.113 0-14.69 6.583-14.69 14.703s6.577 14.703 14.69 14.703zM430.225 190.616l12.275-15.853s4.323-16.618 10.583-15.775c6.26.842-2.472 19.928-2.472 19.928l-12.198 17.548-8.188-5.848zM492.361 401.518l3.955 20.924 8.475 2.262-2.26-24.882-10.17 1.696zM577.672 378.898l15.254 20.924 6.215 2.827 5.085-8.482-15.255-19.793-11.299 4.524z" fill="#FBBEBE"/>
              <path d="M488.971 215.467l-9.425-12.419s-18.259 3.37-19.954 5.067c-1.695 1.696 4.52 32.799 4.52 32.799s1.129 8.483 6.214 13.007l5.085 3.393 41.808-8.483 1.572-18.619a48.897 48.897 0 00-12.871-37.366l-7.275.996-9.674 21.625z" fill="#575A89"/>
              <path d="M461.852 209.246l-2.825-1.131-12.994-1.131s-4.52-1.131-3.39-3.393c1.13-2.262 2.26-2.828 0-3.393-2.26-.566-2.825-1.131-2.26-2.828.565-1.696 3.955-5.089 3.955-5.089l-9.605-7.917s-.52.368-1.36 1.049c-4.769 3.864-19.858 17.807-8.81 31.75 12.995 16.4 28.249 26.013 40.679 22.62l-3.39-30.537z" fill="#575A89"/>
              <path d="M474.281 254.486v7.918s-5.085 9.613-3.39 18.661c1.695 9.048 2.26 13.572 2.26 13.572a77.246 77.246 0 003.955 22.621c3.954 11.31-9.04 85.391 7.344 86.522 16.385 1.131 25.424 2.262 30.509-3.393 5.085-5.655-8.475-102.922-8.475-102.922s46.329 96.702 55.933 92.743c9.605-3.959 33.899-13.007 31.074-18.096-2.825-5.09-74.012-118.191-74.012-118.191l-2.26-5.09-42.938 5.655zM501.399 418.483s-9.04-.565-9.04 2.262c0 2.828-4.52 12.442-4.52 12.442s-3.389 11.31 5.65 10.179c9.04-1.131 14.69-11.31 14.69-11.31l-2.26-10.745-4.52-2.828zM595.751 398.691s-7.91-5.09-7.345-1.697c.565 3.393 1.13 12.441 5.085 13.007 3.954.565 15.819 3.958 16.384 5.089.565 1.131 14.124 5.655 14.124-1.696 0-7.352-8.474-13.007-8.474-13.007l-9.605-7.351s-6.215-.566-7.345 3.393c-1.13 3.958-2.824 2.262-2.824 2.262zM481.084 160.184c5.181 0 9.381-4.203 9.381-9.389 0-5.186-4.2-9.39-9.381-9.39s-9.381 4.204-9.381 9.39c0 5.186 4.2 9.389 9.381 9.389z" fill="#2F2E41"/>
              <path d="M470.715 148.324c0-2.319.858-4.556 2.408-6.28a9.373 9.373 0 015.985-3.057 9.376 9.376 0 00-7.62 2.698 9.393 9.393 0 000 13.278 9.375 9.375 0 007.62 2.698 9.378 9.378 0 01-5.985-3.057 9.393 9.393 0 01-2.408-6.28z" fill="#2F2E41"/>
              <path d="M496.127 161.277l-12.817-6.72-17.701 2.749-3.662 16.19 9.117-.351 2.547-5.948v5.85l4.206-.162 2.441-9.469 1.526 10.08 14.954-.306-.611-11.913z" fill="#2F2E41"/>
              <path d="M495.361 255.797l-19.767.535s-16.867 3.285-15.921-3.53c.946-6.814 17.401-4.431 17.401-4.431l18.012-2.75.275 10.176z" fill="#FBBEBE"/>
              <path d="M511 191.888a4.21 4.21 0 012.861.59 4.227 4.227 0 011.792 2.31c3.87 12.205 15.791 53.052 3.946 58.655-13.951 6.601-24.132 6.311-24.132 6.311l-5.449-13.43 4.96-4.66 5.297-34.086 2.538-14.449 8.187-1.241z" fill="#575A89"/>
              <path opacity=".4" d="M507.333 214.618l-2.26 22.62-19.774 8.483 22.034-5.089v-26.014z" fill="#000"/>
              <path d="M400.69 139.942a26.463 26.463 0 0115.454 11.236l1.848 2.865.093.118 32.421 9.496a2.361 2.361 0 011.399 1.116c.302.541.38 1.179.218 1.777l-2.518 9.237a2.365 2.365 0 01-1.993 1.726 2.358 2.358 0 01-.923-.07l-32.429-9.073-.001.001-3.257 1.232a29.074 29.074 0 01-18.713.637l8.401-30.298z" fill="#3F3D56"/>
              <path d="M434.834 166.732c.307-1.051-1.039-2.369-3.007-2.946-1.968-.576-3.812-.192-4.119.859-.307 1.05 1.039 2.369 3.007 2.945 1.968.576 3.812.192 4.119-.858z" fill="#575A89"/>
              <path d="M433.178 167.7a1.362 1.362 0 10-.002-2.724 1.362 1.362 0 00.002 2.724z" fill="#3F3D56"/>
              <path d="M403.401 157.439c2.703-8.346 1.838-16.103-1.932-17.327-3.77-1.223-9.019 4.55-11.722 12.895-2.704 8.346-1.839 16.103 1.931 17.327 3.771 1.224 9.019-4.55 11.723-12.895z" class="cta-fill"/>
              <path opacity=".4" d="M402.392 157.144c2.605-8.042 1.896-15.536-1.532-17.166.206.026.41.071.608.134 3.77 1.224 4.635 8.981 1.931 17.327-2.703 8.345-7.951 14.119-11.722 12.895a3.276 3.276 0 01-.4-.161c3.709.473 8.554-5.123 11.115-13.029z" fill="#000"/>
              <path d="M401.116 139.971l-73.581-57.13a486.993 486.993 0 01-37.41-32.452c-20.975-20.012-49.449-36.012-82.601-44.53-80.543-20.697-144.35 16-173.372 69.884-44.347 82.34-78.334 215.955 118.303 144.832 43.004-15.555 86.535-17.208 119.541-25.401l119.516-24.665 9.604-30.538z" class="cta-fill"/>
              <path d="M180.211 43.835a3.957 3.957 0 003.955-3.958 3.957 3.957 0 00-3.955-3.959 3.957 3.957 0 00-3.955 3.959 3.957 3.957 0 003.955 3.958zM257.035 49.027h-1.029v-1.03h-.201v1.03h-1.03v.2h1.03v1.031h.201v-1.03h1.029v-.201zM360.426 134.984h-1.029v-1.031h-.202v1.031h-1.029v.201h1.029v1.03h.202v-1.03h1.029v-.201zM353.082 161.562h-1.029v-1.03h-.201v1.03h-1.03v.202h1.03v1.03h.201v-1.03h1.029v-.202zM37.26 184.183h-1.03v-1.031h-.2v1.031H35v.201h1.03v1.03h.2v-1.03h1.03v-.201zM82.457 60.902h-1.03v-1.03h-.2v1.03h-1.03v.202h1.03v1.03h.2v-1.03h1.03v-.202zM258.166 166.086h-1.029v-1.03h-.201v1.03h-1.03v.202h1.03v1.03h.201v-1.03h1.029v-.202zM150.256 24.71h-1.029v-1.03h-.202v1.03h-1.029v.201h1.029v1.03h.202v-1.03h1.029v-.201z" fill="#F2F2F2"/>
              <path d="M150.652 106.13l-1.283.198c.401 2.568.718 5.192.949 7.787l1.294-.113a118.66 118.66 0 00-.96-7.872zM147.143 90.67l-1.243.378a108.924 108.924 0 011.995 7.578l1.271-.288a116.03 116.03 0 00-2.023-7.669zM141.544 75.842l-1.181.543a116.883 116.883 0 013.023 7.233l1.215-.459a115.175 115.175 0 00-3.057-7.317zM133.973 61.942l-1.096.695a117.488 117.488 0 013.977 6.747l1.142-.622a115.398 115.398 0 00-4.023-6.82zM124.561 49.2l-.989.843a115.795 115.795 0 014.87 6.142l1.04-.775a112.857 112.857 0 00-4.921-6.21zM113.497 37.857l-.864.967a114.436 114.436 0 015.661 5.423l.932-.91a113.97 113.97 0 00-5.729-5.48zM101 28.119l-.729 1.074a112.329 112.329 0 016.345 4.603l.802-1.023A117.152 117.152 0 00101 28.119zM89.627 21.355v1.47c1.35.707 2.69 1.448 4 2.206l.65-1.125a117.485 117.485 0 00-4.65-2.55zM150.738 122.137l1.299-.023c.024 1.312.026 2.632.005 3.922l-1.298-.02a116.74 116.74 0 00-.006-3.879zM74.378 217.535l-1.282.198c.4 2.567.717 5.191.949 7.787l1.294-.113c-.232-2.63-.554-5.276-.96-7.872zM70.87 202.074l-1.243.379a109.007 109.007 0 011.994 7.578l1.272-.289a115.927 115.927 0 00-2.023-7.668zM65.27 187.247l-1.18.542a117.256 117.256 0 013.022 7.233l1.215-.458a114.757 114.757 0 00-3.056-7.317zM57.702 173.346l-1.096.696a117.1 117.1 0 013.977 6.746l1.141-.622a114.813 114.813 0 00-4.022-6.82zM48.288 160.606l-.99.842a115.64 115.64 0 014.87 6.142l1.04-.775a112.609 112.609 0 00-4.92-6.209zM37.226 149.262l-.865.967a113.72 113.72 0 015.661 5.423l.933-.911a113.954 113.954 0 00-5.73-5.479zM24.729 139.523L24 140.598a112.57 112.57 0 016.345 4.603l.802-1.023a117.326 117.326 0 00-6.418-4.655zM13.355 132.76v1.47c1.35.707 2.69 1.448 4 2.206l.65-1.126a117.665 117.665 0 00-4.65-2.55zM74.467 233.542l1.299-.023c.023 1.312.025 2.632.005 3.922l-1.299-.02c.02-1.276.018-2.581-.005-3.879zM335.398 161.55l-1.283.198c.401 2.567.718 5.191.949 7.787l1.294-.113c-.231-2.63-.554-5.276-.96-7.872zM331.891 146.089l-1.243.379a108.9 108.9 0 011.995 7.578l1.271-.289a116.054 116.054 0 00-2.023-7.668zM326.29 131.261l-1.181.543a116.94 116.94 0 013.023 7.233l1.215-.458a115.137 115.137 0 00-3.057-7.318zM318.721 117.361l-1.096.696a117.441 117.441 0 013.977 6.746l1.142-.622a115.528 115.528 0 00-4.023-6.82zM309.309 104.62l-.989.843a115.867 115.867 0 014.87 6.141l1.04-.774a112.913 112.913 0 00-4.921-6.21zM298.245 93.276l-.864.967a114.436 114.436 0 015.661 5.424l.932-.91a113.968 113.968 0 00-5.729-5.48zM285.748 83.538l-.728 1.075a112.616 112.616 0 016.344 4.603l.803-1.024a117.614 117.614 0 00-6.419-4.654zM274.375 76.775v1.47a109.7 109.7 0 014 2.206l.65-1.126a118.268 118.268 0 00-4.65-2.55zM335.486 177.557l1.299-.024c.024 1.313.026 2.633.005 3.923l-1.298-.021c.02-1.275.018-2.58-.006-3.878z" fill="#E6E6E6"/>
              <path d="M84.349 113.042h-.958v-.959h-.187v.959h-.958v.187h.958v.959h.187v-.959h.958v-.187zM73.308 170.925h-.958v-.959h-.187v.959h-.958v.188h.958v.958h.187v-.958h.958v-.188zM40.913 221.655h-.958v-.958h-.187v.958h-.958v.188h.958v.959h.187v-.959h.958v-.188z" fill="#F2F2F2"/>
              <path d="M131.029 157.314a69.5 69.5 0 0110.619-89.901 69.35 69.35 0 0144.637-18.277 69.341 69.341 0 0145.755 15.257 69.463 69.463 0 0124.769 41.421 69.511 69.511 0 01-8.185 47.572 69.401 69.401 0 01-37.183 30.742 69.331 69.331 0 01-48.219-.941 22.444 22.444 0 01-25.696 16.03 22.446 22.446 0 01-16.582-13.327 22.49 22.49 0 011.971-21.194 22.456 22.456 0 018.114-7.382z" fill="#3F3D56"/>
              <path d="M188.209 78.853c15.907 0 26.85 8.83 26.85 21.525 0 8.406-4.072 14.223-11.919 18.851-7.38 4.288-9.883 7.43-9.883 12.864a3.365 3.365 0 01-.981 2.372 3.345 3.345 0 01-2.37.982h-8.131a3.353 3.353 0 01-3.349-3.237l-.015-.414c-.721-8.746 2.333-14.181 10.011-18.681 7.168-4.288 10.18-7.005 10.18-12.27 0-5.264-5.09-9.128-11.411-9.128-4.803 0-8.605 2.34-10.349 6.161a7.481 7.481 0 01-6.843 4.283c-5.509 0-9.149-5.864-6.572-10.739 4.076-7.711 12.676-12.57 24.782-12.57zm-11.155 72.77c0-4.882 4.072-8.746 9.077-8.746 5.048 0 9.12 3.821 9.12 8.746 0 4.925-4.072 8.746-9.12 8.746-5.048 0-9.077-3.821-9.077-8.746z" class="cta-fill"/>
            </g>
            <defs>
              <clipPath id="clip0">
                <path fill="#fff" d="M0 0h624v451H0z"/>
              </clipPath>
            </defs>
          </svg>
        </div>
      {/if}
    </section>
  </div>
{/if}
